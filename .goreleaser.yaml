# This is an example .goreleaser.yml file with some sensible defaults.
# Make sure to check the documentation at https://goreleaser.com
before:
  hooks:
    - starport chain build --release --release.prefix v0.1.0 -t linux:amd64 -t darwin:amd64
    - go mod download golang.org/x/mobile
    - go mod tidy

universal_binaries:
- replace: true

builds:
  - id: "highwayd"
    dir: "cmd/highway"
    binary: "highwayd"
    main: "highway.go"
    goos:
      - linux
      - darwin

  - id: "sonr"
    dir: "cmd/sonrd"
    binary: "sonrd"
    goos:
      - darwin
      - linux
    tags: "cli"
    goarch:
      - amd64
      - arm64

  - id: "sonrd"
    skip: true
    dir: "cmd/sonrd"
    binary: "sonrd"

archives:
  - format: tar.gz
    wrap_in_directory: true
    format_overrides:
      - goos: windows
        format: zip
    name_template: "{{ .Binary }}-{{ .Version }}-{{ .Os }}-{{ .Arch }}{{ if .Arm }}v{{ .Arm }}{{ end }}"
    files:
      - LICENSE.md
      - README.md

checksum:
  name_template: 'checksums.txt'
snapshot:
  name_template: "{{ incpatch .Version }}-next"
changelog:
  sort: asc
  filters:
    exclude:
      - '^docs:'
      - '^test:'

brews:
  -
    tap:
      owner: sonr-io
      name: sonr
      token: "{{ .Env.GITHUB_TOKEN }}"
    commit_msg_template: "Brew formula update for {{ .ProjectName }} version {{ .Tag }}"
    folder: Formula
    caveats: "Run `brew info sonr` for more information, or run `sonr --help`."
    homepage: "https://sonr.io"
    description: "The Official Sonr CLI tool for building and deploying services on the Sonr network/blockchain."
    license: "GPLv3"

# .goreleaser.yaml
nfpms:
  -
    package_name: sonr
    vendor: Sonr Inc.
    homepage: https://sonr.io/
    maintainer: The Sonr Team <team@sonr.io>
    description: The Official Sonr CLI tool for building and deploying services on the Sonr network/blockchain.
    license: GPLv3
    priority: extra
    meta: true

# dockers:
#   -
#     id: docker-highway
#     goos: linux
#     goarch: amd64
#     goarm: ''
#     ids:
#     - sonr-highway
#     image_templates:
#     - "sonr-io/highway:latest"
#     - "gcr.io/sonr-io/highway:latest"
#     dockerfile: 'cmd/highway/Dockerfile'
#     use: docker

#     # Template of the docker build flags.
#     build_flag_templates:
#     - "--pull"
#     - "--label=org.opencontainers.image.created={{.Date}}"
#     - "--label=org.opencontainers.image.title={{.ProjectName}}"
#     - "--label=org.opencontainers.image.revision={{.FullCommit}}"
#     - "--label=org.opencontainers.image.version={{.Version}}"
#     - "--platform=linux/arm64"
