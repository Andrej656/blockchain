SHELL=/bin/bash

# Set this -->[/Users/xxxx/Sonr/]<-- to Folder of Sonr Repos
ROOT_DIR:=$(shell dirname $(realpath $(firstword $(MAKEFILE_LIST))))
IOS_FRAMEWORK_DIR=$(ROOT_DIR)/gen/swift/Frameworks
ANDROID_AAR_DIR=$(ROOT_DIR)/gen/java/libs

# @ Packaging Vars/Commands
GOMOBILE=gomobile
GOBIND=$(GOMOBILE) bind -ldflags='-s -w' -v

all: Makefile
	@figlet -f larry3d Sonr Core
	@echo ''
	@sed -n 's/^##//p ' $<

## bind        :   Binds Android and iOS for Plugin Path
bind: bind.ios bind.android
	@go mod tidy
	@cd /System/Library/Sounds && afplay Glass.aiff
	@echo ""
	@echo ""
	@echo "----------------------------------------------------------------"
	@echo "-------- âœ… âœ… âœ…  SUCCESFUL MOBILE BIND  âœ… âœ… âœ…  --------------"
	@echo "----------------------------------------------------------------"


## â””â”€ android       - Android AAR
bind.android:
	@echo ""
	@echo ""
	@echo "--------------------------------------------------------------"
	@echo "--------------- ðŸ¤– START ANDROID BIND ðŸ¤– ----------------------"
	@echo "--------------------------------------------------------------"
	@mkdir -p $(ANDROID_AAR_DIR)
	@go get golang.org/x/mobile/bind
	@gomobile init
	$(GOBIND) -target=android -o $(ANDROID_AAR_DIR)/io.sonr.core.aar
	@echo "âœ… Finished Binding âž¡ `date`"
	@echo ""


## â””â”€ ios           - iOS Framework
bind.ios:
	@echo ""
	@echo ""
	@echo "--------------------------------------------------------------"
	@echo "-------------- ðŸ“± START IOS BIND ðŸ“± ---------------------------"
	@echo "--------------------------------------------------------------"
	@mkdir -p $(IOS_FRAMEWORK_DIR)
	@go get golang.org/x/mobile/bind
	$(GOBIND) -target=ios -bundleid=io.sonr.core -o $(IOS_FRAMEWORK_DIR)/Core.xcframework
	@echo "âœ… Finished Binding âž¡ `date`"
	@echo ""

## [clean]     :   Reinitializes Gomobile and Removes Framworks from Plugin
clean:
	go mod tidy
	go clean -cache -x
	gomobile clean
	rm -rf $(BIND_DIR_IOS)
	rm -rf $(BIND_DIR_ANDROID)
	mkdir -p $(BIND_DIR_IOS)
	mkdir -p $(BIND_DIR_ANDROID)
	gomobile init
